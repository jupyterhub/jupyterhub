{% block password_input %}
  {# Allow full override of the "label" and "input" elements of the username and password fields. #}
  <label for="password_input">Password:</label>

  {# Use Bootstrap input-group for consistent layout and to avoid overlay issues with autofill or password managers #}
  <div class="input-group">
    <input id="password_input"
           {% block password_input_attrs %}
           type="password"
           class="form-control"
           autocomplete="current-password"
           name="password"
           aria-label="Password hidden"
           {% endblock password_input_attrs %} />

    {# Toggle button for showing/hiding password visibility #}
    <button type="button"
            id="toggle_password_visibility"
            class="btn btn-outline-secondary"
            aria-label="Show password"
            aria-controls="password_input"
            aria-pressed="false"
            title="Show password">
      <i class="fa fa-eye" aria-hidden="true"></i>
    </button>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const toggle = document.getElementById("toggle_password_visibility");
      const pwd = document.getElementById("password_input");
      const icon = toggle.querySelector("i");

      toggle.addEventListener("click", function() {
        const isHidden = pwd.type === "password";
        pwd.type = isHidden ? "text" : "password";
        icon.className = isHidden ? "fa fa-eye-slash" : "fa fa-eye";

        // Update accessibility attributes dynamically
        toggle.setAttribute("aria-label", isHidden ? "Hide password" : "Show password");
        pwd.setAttribute("aria-label", isHidden ? "Password visible" : "Password hidden");
        toggle.setAttribute("aria-pressed", isHidden ? "true" : "false");
        toggle.setAttribute("title", isHidden ? "Hide password" : "Show password");
      });
    });
  </script>
{% endblock password_input %}
